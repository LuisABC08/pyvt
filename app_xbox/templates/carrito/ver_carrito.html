{% extends 'base.html' %}

{% block title %}Mi Carrito{% endblock %}

{% block content %}
<div class="container py-4">
    <h2 class="mb-4"><i class="bi bi-cart3"></i> Tu Carrito de Compras</h2>

    {% if pedido and items %}
    <div class="row">
        <!-- Lista de Productos -->
        <div class="col-md-8">
            <div class="card shadow border-0">
                <div class="card-body p-0">
                    <table class="table table-hover mb-0">
                        <thead class="bg-light">
                            <tr>
                                <th>Producto</th>
                                <th class="text-center">Cantidad</th>
                                <th class="text-end">Precio</th>
                                <th class="text-end">Subtotal</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in items %}
                            <tr>
                                <td class="align-middle">
                                    <h6 class="mb-0">{{ item.producto.nombre }}</h6>
                                    <small class="text-muted">
                                        <!-- Esto muestra si es Juego, Consola, etc -->
                                        {{ item.content_type.model|title }}
                                    </small>
                                </td>
                                <td class="align-middle text-center">
                                    <div class="btn-group btn-group-sm">
                                        <a href="{% url 'sumar_restar_item' item.id 'restar' %}" class="btn btn-outline-secondary">-</a>
                                        <button class="btn btn-light" disabled>{{ item.cantidad }}</button>
                                        <a href="{% url 'sumar_restar_item' item.id 'sumar' %}" class="btn btn-outline-secondary">+</a>
                                    </div>
                                </td>
                                <td class="align-middle text-end">${{ item.precio_unitario }}</td>
                                <td class="align-middle text-end fw-bold">${{ item.subtotal }}</td>
                                <td class="align-middle text-end">
                                    <a href="{% url 'eliminar_item_carrito' item.id %}" class="text-danger"><i class="bi bi-trash"></i></a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="mt-3">
                <a href="{% url 'inicio' %}" class="btn btn-outline-dark"><i class="bi bi-arrow-left"></i> Seguir comprando</a>
            </div>
        </div>

        <!-- Resumen del Pedido -->
        <div class="col-md-4">
            <div class="card shadow border-0 bg-light">
                <div class="card-body">
                    <h5 class="card-title border-bottom pb-3">Resumen</h5>
                    <div class="d-flex justify-content-between mb-3">
                        <span>Subtotal</span>
                        <span>${{ pedido.total }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                        <span>Envío</span>
                        <span class="text-success">Gratis</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between mb-4">
                        <span class="h5">Total</span>
                        <span class="h5 fw-bold text-success">${{ pedido.total }}</span>
                    </div>
                    
                    <!-- Este botón lo configuraremos en el siguiente paso -->
                    <a href="{% url 'checkout' %}" class="btn btn-xbox w-100 btn-lg">Proceder al Pago</a>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <!-- Carrito Vacío -->
    <div class="text-center py-5">
        <i class="bi bi-cart-x display-1 text-muted"></i>
        <h3 class="mt-3">Tu carrito está vacío</h3>
        <p class="text-muted">Parece que no has agregado juegos o consolas aún.</p>
        <a href="{% url 'inicio' %}" class="btn btn-xbox mt-3">Ir a la Tienda</a>
    </div>
    {% endif %}
</div>
{% endblock %}